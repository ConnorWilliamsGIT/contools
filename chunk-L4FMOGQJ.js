import"./chunk-6BDIY2AJ.js";import{d as b}from"./chunk-BWXNEIQU.js";import{Ka as d,La as y,Ma as r,Na as g,P as f,Ta as p,Ua as x,Va as u,Ya as m,na as c,oa as v}from"./chunk-FZ62MYCG.js";var n=class{constructor(i,a,t=10,e="white"){this.speed=5,this.pos={x:i,y:a},this.vel={x:Math.round(Math.random())*2-1,y:Math.round(Math.random())*2-1},this.radius=t,this.color=e}draw(i){i.beginPath(),i.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2,!1),i.fillStyle=this.color,i.fill(),i.closePath()}update(){this.pos.x+=this.vel.x*this.speed,this.pos.y+=this.vel.y*this.speed}setPos(i,a){this.pos.x=i,this.pos.y=a}setVel(i,a){this.vel.x=i,this.vel.y=a}setSpeed(i){this.speed=i}setRandomVel(){this.vel.x=Math.round(Math.random())*2-1,this.vel.y=Math.round(Math.random())*2-1}};var w=["canvas"],H=["canvasFrame"],W=(()=>{let i=class i{constructor(){this.pressedKeys=new Set,this.ball=new n(0,0),this.p1Handle={x:0,y:0},this.p2Handle={x:0,y:0},this.expectedBounce=1,this.bounceCount=0,this.speedUpdated=!1,this.animationTime=0,this.winAnimationPlaying=!1,this.scorer=0,this.handleDimDefault={x:20,y:200},this.handleWidth=this.handleDimDefault.x,this.handleHeight=this.handleDimDefault.y,this.score=[0,0],this.paused=!0}ngAfterViewInit(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}this.ctx=this.canvas.nativeElement.getContext("2d"),this.resizeCanvas(),this.ball=new n(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ball.vel.x>0?this.expectedBounce=2:this.expectedBounce=1,this.timeLoop=setInterval(()=>this.computePositions(),1e3/60),this.updateCanvas()}resizeCanvas(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}let t=this.canvasFrame.nativeElement;this.ctx.canvas.width=t.clientWidth,this.ctx.canvas.height=t.clientHeight,this.p1Handle={x:this.ctx.canvas.width/10,y:this.ctx.canvas.height/2},this.p2Handle={x:this.ctx.canvas.width*9/10,y:this.ctx.canvas.height/2},this.handleWidth=this.handleDimDefault.x,this.handleHeight=this.ctx.canvas.height/5,this.updateCanvas()}updateCanvas(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ball.draw(this.ctx),this.drawField(),this.paused&&(this.ctx.font="30px pixelon",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText("Paused",this.ctx.canvas.width/2,this.ctx.canvas.height*4/5),this.ctx.font="15px pixelon",this.ctx.fillText("Press Space to resume",this.ctx.canvas.width/2,this.ctx.canvas.height*4/5+30),this.ctx.font="15px pixelon",this.ctx.fillText("Press R to restart",this.ctx.canvas.width/2,this.ctx.canvas.height*4/5+50),this.ctx.font="15px pixelon",this.ctx.fillText("Player 1: up: W, down: S",this.ctx.canvas.width*3/10,this.ctx.canvas.height*4/5+70),this.ctx.fillText("Player 2: up: O, down: L",this.ctx.canvas.width*7/10,this.ctx.canvas.height*4/5+70)),this.ctx.font="30px pixelon",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(this.score[0].toString(),this.ctx.canvas.width*9/20,this.ctx.canvas.height/10),this.ctx.fillText(this.score[1].toString(),this.ctx.canvas.width*11/20,this.ctx.canvas.height/10),this.winAnimationPlaying&&this.winAnimation(),this.drawHandle(this.p1Handle),this.drawHandle(this.p2Handle)}drawField(){let t=100,e=3;this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width/2,this.ctx.canvas.height/2,t,0,Math.PI*2,!1),this.ctx.arc(this.ctx.canvas.width/2,this.ctx.canvas.height/2,t-e,0,Math.PI*2,!0),this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fill(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.moveTo(this.ctx.canvas.width/2,0),this.ctx.lineTo(this.ctx.canvas.width/2,this.ctx.canvas.height),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=e,this.ctx.stroke(),this.ctx.closePath()}drawHandle(t){this.ctx.beginPath(),this.ctx.rect(t.x-this.handleWidth/2,t.y-this.handleHeight/2,this.handleWidth,this.handleHeight),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.closePath()}handleKeyboardEvent(t){let e=t.key;e==="r"&&this.restart(!0),e===" "&&this.togglePause(),this.pressedKeys.add(t.key)}handleKeyUp(t){this.pressedKeys.delete(t.key)}isKeyDown(t){return this.pressedKeys.has(t)}restart(t=!1){this.paused=!0,this.ball.setPos(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ball.setRandomVel(),this.bounceCount=0,this.speedUpdated=!1,this.ball.setSpeed(5),this.ball.vel.x>0?this.expectedBounce=2:this.expectedBounce=1,t&&(this.score=[0,0]),this.updateCanvas()}togglePause(){this.paused=!this.paused}scorePoint(t){this.restart(),this.score[t]++,this.animationTime=0,this.winAnimationPlaying=!0,this.scorer=t}winAnimation(){this.animationTime+=1e3/60;let t=500,e=Math.round(100*(this.animationTime/t))/100;if(this.animationTime>t){this.winAnimationPlaying=!1;return}this.ctx.beginPath(),this.ctx.rect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);let s=5,h=this.scorer==1?"230, 50, 50,":"10, 90, 190,";this.ctx.fillStyle="rgba("+h+(1/s-e/s)+")",this.ctx.fill(),this.ctx.closePath()}computePositions(){this.paused||this.computeBallPosition(),this.isKeyDown("w")&&(this.p1Handle.y-=5),this.isKeyDown("s")&&(this.p1Handle.y+=5),this.isKeyDown("o")&&(this.p2Handle.y-=5),this.isKeyDown("l")&&(this.p2Handle.y+=5),this.p1Handle.y<this.handleHeight/2&&(this.p1Handle.y=this.handleHeight/2),this.p1Handle.y>this.ctx.canvas.height-this.handleHeight/2&&(this.p1Handle.y=this.ctx.canvas.height-this.handleHeight/2),this.p2Handle.y<this.handleHeight/2&&(this.p2Handle.y=this.handleHeight/2),this.p2Handle.y>this.ctx.canvas.height-this.handleHeight/2&&(this.p2Handle.y=this.ctx.canvas.height-this.handleHeight/2),this.bounceCount%2==0&&!this.speedUpdated&&this.bounceCount!=0?(this.ball.setSpeed(this.ball.speed*1.1),console.log("Speed updated",this.bounceCount,this.speedUpdated),this.speedUpdated=!0):this.bounceCount%2!=0&&(console.log("Speed not updated"),this.speedUpdated=!1),this.updateCanvas()}computeBallPosition(){if((this.ball.pos.x+this.ball.radius<-100||this.ball.pos.x-this.ball.radius>this.ctx.canvas.width+100)&&this.ball.setPos(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ball.pos.x+this.ball.radius>this.ctx.canvas.width){this.scorePoint(0);return}if(this.ball.pos.x-this.ball.radius<0){this.scorePoint(1);return}(this.ball.pos.y+this.ball.radius>this.ctx.canvas.height||this.ball.pos.y-this.ball.radius<0)&&(this.ball.vel.y*=-1),this.expectedBounce==1&&this.ball.pos.x-this.ball.radius<this.p1Handle.x+15&&this.ball.pos.x-this.ball.radius>this.p1Handle.x-15&&this.ball.pos.y+this.ball.radius>this.p1Handle.y-50-10&&this.ball.pos.y-this.ball.radius<this.p1Handle.y+50+10&&(this.ball.vel.x*=-1,this.expectedBounce=2,this.bounceCount++),this.expectedBounce==2&&this.ball.pos.x+this.ball.radius>this.p2Handle.x-15&&this.ball.pos.x+this.ball.radius<this.p2Handle.x+15&&this.ball.pos.y+this.ball.radius>this.p2Handle.y-50-10&&this.ball.pos.y-this.ball.radius<this.p2Handle.y+50+10&&(this.ball.vel.x*=-1,this.expectedBounce=1,this.bounceCount++),this.ball.update()}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=f({type:i,selectors:[["app-pong"]],viewQuery:function(e,s){if(e&1&&(p(w,5),p(H,5)),e&2){let h;x(h=u())&&(s.canvas=h.first),x(h=u())&&(s.canvasFrame=h.first)}},hostBindings:function(e,s){e&1&&g("resize",function(){return s.resizeCanvas()},!1,c)("keydown",function(o){return s.handleKeyboardEvent(o)},!1,v)("keyup",function(o){return s.handleKeyUp(o)},!1,c)},standalone:!0,features:[m],decls:7,vars:0,consts:[[1,"flex","flex-col","min-h-screen"],[1,"flex-grow-0"],[1,"static","flex-grow","flex","inset-0","bg-base-100","bg-[radial-gradient(#94a3b8_1px,transparent_1px)]","[background-size:40px_40px]","[background-position:16px_36px]","row-span-2"],[1,"w-full","flex-grow","relative"],["canvasFrame",""],["canvas",""]],template:function(e,s){e&1&&(d(0,"div",0),r(1,"app-navbar",1),d(2,"div",2)(3,"div",3,4),r(5,"canvas",null,5),y()()())},dependencies:[b],styles:['@font-face{font-family:pixelon;src:url("./media/pixelon.regular-TUGGVAW7.ttf") format("truetype")}']});let l=i;return l})();export{W as PongComponent};
