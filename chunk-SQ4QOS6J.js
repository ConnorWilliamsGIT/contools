import{Da as $,Fa as T,Ga as V,Ha as W,Ia as H,Ja as J,Ka as _,La as w,Ma as R,Na as X,Oa as z,P as G,Ra as Y,Ta as Z,Ua as ee,Va as te,Wa as b,Xa as ie,Ya as oe,c as q,la as M,lb as ne,qa as D,va as K}from"./chunk-FZ62MYCG.js";var ge=["errorModal"];function de(m,d){if(m&1&&(_(0,"div")(1,"p",12),b(2," Note: Anvil image should look something like this."),R(3,"br"),b(4," Don't include the UI border or anything else in the screenshot. "),w(),R(5,"img",13),w()),m&2){let E=z();D(5),T("src",E.exampleImg,M)}}function he(m,d){m&1&&b(0," \u2192 ")}function pe(m,d){if(m&1&&(R(0,"img",21),$(1,he,1,0)),m&2){let E=d.$implicit,r=d.$index,n=d.$count;Y("src","assets/img/",E,".png",M),D(),V(1,r!==n-1?1:-1)}}function ue(m,d){if(m&1&&(_(0,"div",14)(1,"div",15),R(2,"img",16),w(),R(3,"div",17),_(4,"div",18)(5,"p",19),b(6),R(7,"br"),b(8," Moves: "),w(),_(9,"div",20),H(10,pe,2,2,null,null,W),w()()()),m&2){let E=z();D(2),T("src",E.imageUrl,M),D(4),ie(" Steps: ",E.forgeText().length,""),D(4),J(E.forgeText())}}var De=(()=>{let d=class d{constructor(){this.modalButton=document.getElementById("modal_button"),this.imageUrl="",this.exampleImg="/assets/img/exampleForge.png",this.forgeText=K([])}ngOnInit(){this.modalButton=document.getElementById("modal_button")}pasteImage(){return q(this,null,function*(){let r=yield navigator.clipboard.read();for(let n of r){if(!n.types.includes("image/png")){console.log("Clipboard item is not an image");continue}let i=yield n.getType("image/png");this.imageUrl=URL.createObjectURL(i),this.processImage()}})}processImage(){try{let r=document.createElement("canvas"),n=r.getContext("2d"),i=new Image;i.onload=()=>{if(n===null){console.log("Context is null");return}r.width=i.width,r.height=i.height,console.log("Image width: "+i.width),console.log("Image height: "+i.height),n.drawImage(i,0,0,r.width,r.height);let a=n.getImageData(0,0,i.width,i.height),h=0,p=!1,c=0,f=0;for(let e=0;e<i.height;e++){for(let t=0;t<i.width;t++){console.log("Row: "+e+" Col: "+t);let l=this.getPixel(a,e*i.width+t);if(l[0]==63&&l[1]==63&&l[2]==63)h+=1,p||(p=!0,c=e,f=t);else if(p)break}if(p)break}if(!p)throw console.log("A not found"),new Error("A not found");let o=h/3;f-=o;let P=0,A=0,F=96;for(let e=0;e<i.width;e++){let t=this.getPixel(a,(F*o+c)*i.width+e);if(t[0]==0&&t[1]==255&&t[2]==6){P=e;break}}F=90;for(let e=0;e<i.width;e++){let t=this.getPixel(a,(F*o+c)*i.width+e);if(t[0]==255&&t[1]==0&&t[2]==0){A=e;break}}let u=(A-P)/o;if(console.log("distance: "+u),isNaN(u))throw console.log("Distance is NaN"),new Error("Distance is NaN");let x=[[56,66],[75,85],[94,104]],y=[0,0,0],U=[0,0,0];for(let e=0;e<x.length;e++)for(let t=c+4*o;t<c+14*o;t++){for(let l=f+x[e][0]*o;l<f+x[e][1]*o;l++){let s=this.getPixel(a,t*i.width+l);if(s[0]>100&&s[1]>100&&s[2]>100){y[e]=t,U[e]=l;break}}if(y[e]!==0)break}for(let e=0;e<y.length;e++)y[e]=(y[e]-4*o)/o,U[e]=(U[e]-x[e][0]*o)/o;let C=[0,0,0],N=[0,0,0];for(let e=0;e<x.length;e++)for(let t=f+x[e][1]*o-1;t>=f+x[e][0]*o;t--){for(let l=c+4*o;l<c+14*o;l++){let s=this.getPixel(a,l*i.width+t);if(s[0]>100&&s[1]>100&&s[2]>100){C[e]=l,N[e]=t;break}}if(C[e]!==0)break}for(let e=0;e<C.length;e++)C[e]=(C[e]-4*o)/o,N[e]=(N[e]-x[e][0]*o)/o;let S=[0,0,0],B=[0,0,0];for(let e=0;e<x.length;e++)for(let t=f+x[e][0]*o;t<f+x[e][1]*o;t++){for(let l=c+14*o-1;l>=c+4*o;l--){let s=this.getPixel(a,l*i.width+t);if(s[0]>100&&s[1]>100&&s[2]>100){S[e]=l,B[e]=t;break}}if(S[e]!==0)break}for(let e=0;e<S.length;e++)S[e]=(S[e]-4*o)/o,B[e]=(B[e]-x[e][0]*o)/o;let L=y.map((e,t)=>{let l=C[t]-y[t],s=N[t]-U[t];return{rowDiff:l,colDiff:s}}).map(e=>e.rowDiff/e.colDiff),le=C.map((e,t)=>{let l=S[t]-C[t],s=B[t]-N[t];return{rowDiff:l,colDiff:s}}).map(e=>e.rowDiff/e.colDiff),re={"0.23":-1,"0.21":13,"0.176":16},ae={"0.26":-1,"0.15":13,"0.12":16},se={"-0.23":-15,"-0.29":2,"-0.69":7},ce={"-0.16":-15,"-0.36":2,"-0.79":7},v=[0,0,0],j;for(let e=0;e<3;e++){let t=L[e]===0,l=t?le[e]:L[e];o===2?j=t?se:re:j=t?ce:ae,v[e]=this.findClosestIcon(j,l)}for(let e=0;e<y.length;e++)y[e]<=0&&(v[e]=0);let k=[[0,0,0],[0,0,0],[0,0,0]];for(let e=0;e<3;e++){let t=this.getPixel(a,(c+17*o)*i.width+f+52*o+e*19*o),l=this.getPixel(a,(c+19*o)*i.width+f+52*o+e*19*o),s=this.getPixel(a,(c+21*o)*i.width+f+52*o+e*19*o);k[e][0]=t[0]==216&&t[1]==86&&t[2]==0?1:0,k[e][1]=l[0]==216&&l[1]==86&&l[2]==0?1:0,k[e][2]=s[0]==216&&s[1]==86&&s[2]==0?1:0}let fe=u,I=[0,0,0],g=[0,1,2];for(let e=0;e<3;e++)if(k[e][2]==1&&k[e][1]==0&&k[e][0]==0){g=[e,...g.filter((t,l)=>l!==e)];break}if(k[g[0]][2]==1){if(v[g[0]]==-1){let e=this.findBestOption(u);u-=e,I[0]=e}else u-=v[g[0]],I[0]=v[g[0]];if(k[g[1]][1]==1&&v[g[1]]==-1){let e=this.findBestOption(u);u-=e,I[1]=e}else u-=v[g[1]],I[1]=v[g[1]];if(k[g[2]][0]==1&&v[g[2]]==-1){let e=this.findBestOption(u);u-=e,I[2]=e}else u-=v[g[2]],I[2]=v[g[2]]}let[be,O]=this.minStepsToN(u);I=I.filter(e=>e!==0),O.push(...I.reverse()),console.log("Moves: "+O);let Q=0;for(let e=0;e<O.length;e++)Q+=O[e];let me=Q==fe;console.log("validation check: "+me),this.forgeText.set(O.map(e=>e.toString())),n.putImageData(a,0,0),this.imageUrl=r.toDataURL()},i.src=this.imageUrl;return}catch(r){console.log(r),console.log("Error processing image"),this.errorModal.nativeElement.showModal(),this.imageUrl=""}}findClosestIcon(r,n){let i=Object.keys(r)[0],a=Math.abs(n-Number(i));for(let h of Object.keys(r)){let p=Math.abs(n-Number(h));p<a&&(i=h,a=p)}return r[Number(i)]}getPixel(r,n){return r.data.subarray(n*4,n*4+4)}setPixel(r,n,i){r.data.set(i,n*4)}findBestOption(r){let n=0,i=1e3,a=[-3,-6,-9];for(let h=0;h<3;h++){let p=r+a[h],[c,f]=this.minStepsToN(p);c<i&&(n=a[h],i=c)}return n}minStepsToN(r){let n=[-15,-9,-6,-3,2,7,13,16],i=150;r=Math.abs(Math.round(r));let a=[{sum:0,steps:0,path:[]}],h=new Set([0]);for(;a.length>0;){let{sum:p,steps:c,path:f}=a.shift();if(p===r)return[c,f];for(let o of n){let P=p+o;P>i||h.has(P)||(a.push({sum:P,steps:c+1,path:[...f,o]}),h.add(P))}}return console.log("No solution found."),[-1,[]]}};d.\u0275fac=function(n){return new(n||d)},d.\u0275cmp=G({type:d,selectors:[["app-forge"]],viewQuery:function(n,i){if(n&1&&Z(ge,5),n&2){let a;ee(a=te())&&(i.errorModal=a.first)}},standalone:!0,features:[oe],decls:20,vars:2,consts:[[1,"text-center","content-center","justify-center","h-svh","max-h-svh","items-center","flex","flex-col"],[1,"text-3xl","flex-none","font-bold","p-3","text-center","w-100","text-secondary"],[1,"text-center","content-center","justify-center","items-center","flex-1","flex","flex-col","w-[100%]"],[1,"btn","btn-primary","grow-0",3,"click"],[4,"ngIf"],["class","flex w-[90%] items-start mt-10 gap-3 max-h-[700px]",4,"ngIf"],[1,"modal"],["errorModal",""],[1,"modal-box"],[1,"text-lg","font-bold"],[1,"py-4"],["method","dialog",1,"modal-backdrop"],[1,"text-neutral-content"],["alt","Example Image",3,"src"],[1,"flex","w-[90%]","items-start","mt-10","gap-3","max-h-[700px]"],[1,"outline","outline-base-content/50","rounded","rounded-4","grid","flex-none"],["alt","Pasted Image",3,"src"],[1,"inline-block","h-auto","min-h-[1em]","w-0.5","self-stretch","bg-base","dark:bg-white/10"],[1,"flex-1","max-h-[700px]","overflow-y-auto"],[1,"text-neutral-content","whitespace-normal"],[1,"flex","gap-1","items-center","justify-center","mt-5","flex-wrap"],["alt","Pasted Image",1,"w-10",3,"src"]],template:function(n,i){n&1&&(_(0,"div",0)(1,"h1",1),b(2,"Contools"),w(),_(3,"div",2)(4,"button",3),X("click",function(){return i.pasteImage()}),b(5,"Paste Image from clipboard"),w(),$(6,de,6,1,"div",4)(7,ue,12,2,"div",5),w()(),_(8,"dialog",6,7)(10,"div",8)(11,"h3",9),b(12,"An error has occurred."),w(),_(13,"p",10),b(14,"Click anywhere to continue. "),R(15,"br"),b(16," If the error persists, close and reopen the page."),w()(),_(17,"form",11)(18,"button"),b(19,"close"),w()()()),n&2&&(D(6),T("ngIf",i.imageUrl==""),D(),T("ngIf",i.imageUrl!=""))},dependencies:[ne]});let m=d;return m})();export{De as ForgeComponent};
