import{a as F}from"./chunk-3GHLPITM.js";import"./chunk-QWULPANI.js";import{Ka as y,La as B,Ma as m,Na as R,P as w,Ta as c,Ua as d,Va as v,Ya as b,na as L,oa as S}from"./chunk-FZ62MYCG.js";var g=class{constructor(h,p,t=.01){this.pos={x:0,y:0},this.vel={x:0,y:0},this.heading=0,this.maxSpeed=300,this.minSpeed=150,this.protectedRange=20,this.visualRange=80,this.separationFactor=.05,this.alignmentFactor=.04,this.cohesionFactor=1e-4,this.turnFactor=18,this.timeLast=0,this.xIndex=0,this.yIndex=0,this.pos.x=h,this.pos.y=p,this.xIndex=Math.floor(this.pos.x/(2*this.visualRange)),this.yIndex=Math.floor(this.pos.y/(2*this.visualRange)),this.heading=t,this.timeLast=Date.now()}setCoordinate(h){this.pos.x=h.x,this.pos.y=h.y}computePosition(h,p,t){let s=0,i=0,e=0,n=0,l=0;h.forEach((o,f)=>{let x=p.get(this)?.get(o)||0;x<this.protectedRange&&(this.vel.x+=(this.pos.x-o.pos.x)*this.separationFactor,this.vel.y+=(this.pos.y-o.pos.y)*this.separationFactor),x<this.visualRange&&x>this.protectedRange&&(s+=o.vel.x,i+=o.vel.y,e+=o.pos.x,n+=o.pos.y,l++)}),l>0&&(s/=l,i/=l,this.vel.x+=(s-this.vel.x)*this.alignmentFactor,this.vel.y+=(i-this.vel.y)*this.alignmentFactor,e/=l,n/=l,this.vel.x+=(e-this.pos.x)*this.cohesionFactor,this.vel.y+=(n-this.pos.y)*this.cohesionFactor),this.pos.x<t.left&&(this.vel.x+=this.turnFactor),this.pos.x>t.right&&(this.vel.x-=this.turnFactor),this.pos.y<t.top&&(this.vel.y+=this.turnFactor),this.pos.y>t.bottom&&(this.vel.y-=this.turnFactor);let a=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);this.vel.x*this.vel.x+this.vel.y*this.vel.y<=0&&(a=0),a>this.maxSpeed&&(this.vel.x=this.vel.x/a*this.maxSpeed,this.vel.y=this.vel.y/a*this.maxSpeed),a<this.minSpeed&&(this.vel.x=this.vel.x/a*this.minSpeed,this.vel.y=this.vel.y/a*this.minSpeed),a==0&&(this.vel.x=this.minSpeed*Math.sin(this.heading+Math.PI),this.vel.y=-this.minSpeed*Math.cos(this.heading));let r=this.getTimeStep();this.pos.x+=this.vel.x*r,this.pos.y+=this.vel.y*r,this.heading=Math.atan2(this.vel.y,this.vel.x)+Math.PI/2}getTimeStep(){let h=Date.now(),p=h-this.timeLast;return this.timeLast=h,p/1e3}};var M=["canvas"],C=["canvasFrame"],I=["image"],H=["deleteButton"],P=["resetButton"],q=(()=>{let h=class h{constructor(){this.boidCount=500,this.boidHeight=7,this.boidScale=.7,this.boidList=[],this.gridLists=[],this.testBoid=new g(0,0),this.paused=!1,this.showGrid=!1,this.showBoidRange=!1,this.margin=100}ngAfterViewInit(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}this.ctx=this.canvas.nativeElement.getContext("2d"),this.resizeCanvas(),this.paused||(this.paused=!0,this.toggleTime()),this.gridLists=Array.from({length:Math.ceil(this.ctx.canvas.width/(2*this.testBoid.visualRange))},()=>Array.from({length:Math.ceil(this.ctx.canvas.height/(2*this.testBoid.visualRange))},()=>[])),this.spawnBoids(this.boidCount),this.updateCanvas()}resizeCanvas(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}let t=this.canvasFrame.nativeElement;this.ctx.canvas.width=t.clientWidth,this.ctx.canvas.height=t.clientHeight,this.updateCanvas()}toggleTime(){this.paused?(this.timeLoop=setInterval(()=>{this.computeBoids()},10),this.paused=!1):(clearInterval(this.timeLoop),this.paused=!0)}updateCanvas(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.boidList.forEach(t=>this.drawBoid(t)),this.showGrid&&this.drawGrid()}drawGrid(){this.gridLists.forEach((t,s)=>{t.forEach((i,e)=>{(s+e)%2===0?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 0, 0, 0)",this.ctx.fillRect(s*2*this.testBoid.visualRange,e*2*this.testBoid.visualRange,2*this.testBoid.visualRange,2*this.testBoid.visualRange)})})}drawBoid(t){this.ctx.save(),this.ctx.translate(t.pos.x,t.pos.y),this.ctx.rotate(t.heading),this.ctx.beginPath(),this.ctx.moveTo(0,-this.boidHeight*this.boidScale),this.ctx.lineTo(Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(-Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(0,-this.boidHeight*this.boidScale),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this.showBoidRange&&(this.ctx.beginPath(),this.ctx.arc(t.pos.x,t.pos.y,t.visualRange,0,2*Math.PI,!1),this.ctx.arc(t.pos.x,t.pos.y,t.protectedRange,2*Math.PI,0,!0),this.ctx.closePath(),this.ctx.fillStyle="rgba(200, 200, 255, 0.1)",this.ctx.fill())}spawnBoids(t,s=-1,i={x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/2}){let e,n;s===-1?(e=this.ctx.canvas.width-80,n=this.ctx.canvas.height-80):(e=s,n=s);for(let l=0;l<t;l++){let a=i.x+Math.random()*e-e/2,r=i.y+Math.random()*n-n/2;this.boidList.push(new g(a,r)),this.boidList[this.boidList.length-1].visualRange*=this.boidScale,this.boidList[this.boidList.length-1].protectedRange*=this.boidScale,this.boidList[this.boidList.length-1].maxSpeed*=this.boidScale,this.boidList[this.boidList.length-1].minSpeed*=this.boidScale,this.gridLists[this.boidList[this.boidList.length-1].xIndex][this.boidList[this.boidList.length-1].yIndex].push(this.boidList[this.boidList.length-1])}}handleKeyboardEvent(t){let s=t.key;s===" "&&this.toggleTime(),s==="x"&&this.computeBoids()}computeBoids(){let t=new Map,s=new Map;this.boidList.forEach((i,e)=>{t.set(i,new Map),s.set(i,[]);let n=i.xIndex,l=i.yIndex;for(let a=-1;a<=1;a++)for(let r=-1;r<=1;r++)this.gridLists[n+a]!==void 0&&this.gridLists[n+a][l+r]!==void 0&&this.gridLists[n+a][l+r].forEach(o=>{if(o!==i){let f=Math.sqrt((i.pos.x-o.pos.x)**2+(i.pos.y-o.pos.y)**2);t.get(i)?.set(o,f),f<i.visualRange&&s.get(i)?.push(o)}})}),this.boidList.forEach(i=>{i.computePosition(s.get(i)||[],t,{left:0+this.margin,right:this.ctx.canvas.width-this.margin,top:0+this.margin,bottom:this.ctx.canvas.height-this.margin})}),this.updateCanvas()}};h.\u0275fac=function(s){return new(s||h)},h.\u0275cmp=w({type:h,selectors:[["app-boids"]],viewQuery:function(s,i){if(s&1&&(c(M,5),c(C,5),c(I,5),c(H,5),c(P,5)),s&2){let e;d(e=v())&&(i.canvas=e.first),d(e=v())&&(i.canvasFrame=e.first),d(e=v())&&(i.image=e.first),d(e=v())&&(i.deleteButton=e.first),d(e=v())&&(i.resetButton=e.first)}},hostBindings:function(s,i){s&1&&R("resize",function(){return i.resizeCanvas()},!1,L)("keypress",function(n){return i.handleKeyboardEvent(n)},!1,S)},standalone:!0,features:[b],decls:6,vars:0,consts:[["settings",""],["canvas","",1,"w-full","h-full","relative"],["canvasFrame",""],["canvas",""]],template:function(s,i){s&1&&(y(0,"app-layout"),m(1,"div",0),y(2,"div",1,2),m(4,"canvas",null,3),B()())},dependencies:[F]});let u=h;return u})();export{q as BoidsComponent};
