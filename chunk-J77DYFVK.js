import{a as C}from"./chunk-3GHLPITM.js";import"./chunk-QWULPANI.js";import{Ka as h,La as o,Ma as g,Na as I,P as M,Ta as y,Ua as u,Va as S,Wa as e,Ya as R,na as E,oa as F}from"./chunk-FZ62MYCG.js";var f={boid:{boid:{separationFactor:.05,alignmentFactor:.02,cohesionFactor:5e-4,avoidFactor:0},shark:{separationFactor:.1,alignmentFactor:-.001,cohesionFactor:-.1,avoidFactor:.1}},shark:{boid:{separationFactor:0,alignmentFactor:1e-4,cohesionFactor:.001,avoidFactor:-.1},shark:{separationFactor:.05,alignmentFactor:.02,cohesionFactor:5e-4,avoidFactor:1}}};var v={boid:{type:"boid",colour:"white"},shark:{type:"shark",colour:"red"}};var L=class{constructor(c,w,i=v.boid.type,s=.01){this.pos={x:0,y:0},this.vel={x:0,y:0},this.heading=0,this.boidType=v.boid.type,this.timeLast=0,this.settings={protectedRange:10,visualRange:80,maxSpeed:300,minSpeed:150,turnFactor:4,colour:"white"},this.xIndex=0,this.yIndex=0,this.pos.x=c,this.pos.y=w,this.boidType=i,this.settings.colour=v[i].colour,this.xIndex=Math.floor(this.pos.x/(2*this.settings.visualRange)),this.yIndex=Math.floor(this.pos.y/(2*this.settings.visualRange)),this.heading=s,this.timeLast=Date.now()}setCoordinate(c){this.pos.x=c.x,this.pos.y=c.y}computePosition(c,w,i){let s={},t={},n={},l={},x={};for(let r in v){let a=v[r].type;s[a]=0,t[a]=0,n[a]=0,l[a]=0,x[a]=0}c.forEach((r,a)=>{let B=w.get(this)?.get(r)||0;B<this.settings.protectedRange&&(this.vel.x+=(this.pos.x-r.pos.x)*f[this.boidType][r.boidType].separationFactor,this.vel.y+=(this.pos.y-r.pos.y)*f[this.boidType][r.boidType].separationFactor),B<this.settings.visualRange&&B>this.settings.protectedRange&&(this.vel.x+=(this.pos.x-r.pos.x)*f[this.boidType][r.boidType].avoidFactor,this.vel.y+=(this.pos.y-r.pos.y)*f[this.boidType][r.boidType].avoidFactor,s[r.boidType]+=r.vel.x,t[r.boidType]+=r.vel.y,n[r.boidType]+=r.pos.x,l[r.boidType]+=r.pos.y,x[r.boidType]++)});for(let r in v){let a=v[r].type;x[a]>0&&(s[a]/=x[a],t[a]/=x[a],this.vel.x+=(s[a]-this.vel.x)*f[this.boidType][a].alignmentFactor,this.vel.y+=(t[a]-this.vel.y)*f[this.boidType][a].alignmentFactor,n[a]/=x[a],l[a]/=x[a],this.vel.x+=(n[a]-this.pos.x)*f[this.boidType][a].cohesionFactor,this.vel.y+=(l[a]-this.pos.y)*f[this.boidType][a].cohesionFactor)}this.pos.x<i.left&&(this.vel.x+=this.settings.turnFactor),this.pos.x>i.right&&(this.vel.x-=this.settings.turnFactor),this.pos.y<i.top&&(this.vel.y+=this.settings.turnFactor),this.pos.y>i.bottom&&(this.vel.y-=this.settings.turnFactor);let d=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);this.vel.x*this.vel.x+this.vel.y*this.vel.y<=0&&(d=0),d>this.settings.maxSpeed&&(this.vel.x=this.vel.x/d*this.settings.maxSpeed,this.vel.y=this.vel.y/d*this.settings.maxSpeed),d<this.settings.minSpeed&&(this.vel.x=this.vel.x/d*this.settings.minSpeed,this.vel.y=this.vel.y/d*this.settings.minSpeed),d==0&&(this.vel.x=this.settings.minSpeed*Math.sin(this.heading+Math.PI),this.vel.y=-this.settings.minSpeed*Math.cos(this.heading));let m=1,p=(Math.random()*2*m-m)*Math.PI/180;this.vel.x=this.vel.x*Math.cos(p)-this.vel.y*Math.sin(p),this.vel.y=this.vel.x*Math.sin(p)+this.vel.y*Math.cos(p);let b=this.getTimeStep();this.pos.x+=this.vel.x*b,this.pos.y+=this.vel.y*b,this.heading=Math.atan2(this.vel.y,this.vel.x)+Math.PI/2}getTimeStep(){let c=Date.now(),w=c-this.timeLast;return this.timeLast=c,w/1e3}};var A=["canvas"],k=["canvasFrame"],P=["image"],H=["deleteButton"],D=["resetButton"],W=(()=>{let c=class c{constructor(){this.boidCount=500,this.sharkCount=1,this.boidHeight=7,this.boidScale=.7,this.boidList=[],this.gridLists=[],this.testBoid=new L(0,0),this.paused=!1,this.showGrid=!1,this.showBoidRange=!1,this.margin=100,this.showBoidTrail=!1,this.boidTrailLength=50,this.boidTrail=new Map,this.shiftPressed=!1}ngAfterViewInit(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}this.ctx=this.canvas.nativeElement.getContext("2d"),this.resizeCanvas(),this.paused||(this.paused=!0,this.toggleTime()),this.testBoid.settings.visualRange*=this.boidScale,this.testBoid.settings.protectedRange*=this.boidScale,this.gridLists=Array.from({length:Math.ceil(this.ctx.canvas.width/(2*this.testBoid.settings.visualRange))},()=>Array.from({length:Math.ceil(this.ctx.canvas.height/(2*this.testBoid.settings.visualRange))},()=>[])),this.spawnBoids(this.boidCount,"boid"),this.spawnBoids(this.sharkCount,"shark"),this.updateCanvas()}resizeCanvas(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}let i=this.canvasFrame.nativeElement;this.ctx.canvas.width=i.clientWidth,this.ctx.canvas.height=i.clientHeight,this.updateCanvas()}toggleTime(){this.paused?(this.timeLoop=setInterval(()=>{this.computeBoids()},10),this.paused=!1):(clearInterval(this.timeLoop),this.paused=!0)}updateCanvas(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.boidList.forEach(i=>this.drawBoid(i)),this.showGrid&&this.drawGrid(),this.showBoidTrail&&this.drawTrail()}drawTrail(){this.boidTrail.forEach((i,s)=>{this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y),i.forEach(t=>{this.ctx.lineTo(t.x,t.y)}),this.ctx.strokeStyle=s.settings.colour,this.ctx.stroke()})}drawGrid(){this.gridLists.forEach((i,s)=>{i.forEach((t,n)=>{(s+n)%2===0?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 0, 0, 0)",this.ctx.fillRect(s*2*this.testBoid.settings.visualRange,n*2*this.testBoid.settings.visualRange,2*this.testBoid.settings.visualRange,2*this.testBoid.settings.visualRange)})})}drawBoid(i){this.ctx.save(),this.ctx.translate(i.pos.x,i.pos.y),this.ctx.rotate(i.heading),this.ctx.beginPath(),this.ctx.moveTo(0,-this.boidHeight*this.boidScale),this.ctx.lineTo(Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(-Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(0,-this.boidHeight*this.boidScale),this.ctx.fillStyle=i.settings.colour,this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this.showBoidRange&&(this.ctx.beginPath(),this.ctx.arc(i.pos.x,i.pos.y,i.settings.visualRange,0,2*Math.PI,!1),this.ctx.arc(i.pos.x,i.pos.y,i.settings.protectedRange,2*Math.PI,0,!0),this.ctx.closePath(),i.boidType==="shark"?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fill())}spawnBoids(i,s,t=-1,n={x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/2}){let l,x;t===-1?(l=this.ctx.canvas.width-80,x=this.ctx.canvas.height-80):(l=t,x=t);for(let d=0;d<i;d++){let m=n.x+Math.random()*l-l/2,p=n.y+Math.random()*x-x/2;this.boidList.push(new L(m,p,s)),s==="shark"&&(this.boidList[this.boidList.length-1].settings.turnFactor*=2),this.boidList[this.boidList.length-1].settings.visualRange*=this.boidScale,this.boidList[this.boidList.length-1].settings.protectedRange*=this.boidScale,this.boidList[this.boidList.length-1].settings.maxSpeed*=this.boidScale,this.boidList[this.boidList.length-1].settings.minSpeed*=this.boidScale,this.gridLists[this.boidList[this.boidList.length-1].xIndex][this.boidList[this.boidList.length-1].yIndex].push(this.boidList[this.boidList.length-1])}}handleKeyboardEvent(i){let s=i.key;s===" "&&this.toggleTime(),s==="x"&&this.computeBoids(),s==="g"&&(this.showGrid=!this.showGrid),s==="r"&&(this.showBoidRange=!this.showBoidRange),s==="t"&&(this.showBoidTrail=!this.showBoidTrail),s==="c"&&(this.showBoidRange=!1,this.showGrid=!1,this.showBoidTrail=!1),s==="C"&&(this.showBoidRange=!0,this.showGrid=!0,this.showBoidTrail=!0),s==="ArrowUp"&&(i.getModifierState("Control")?this.boidTrailLength+=50:i.getModifierState("Alt")&&i.getModifierState("Shift")?this.spawnBoids(50,"shark"):i.getModifierState("Alt")?this.spawnBoids(1,"shark"):i.getModifierState("Shift")?this.spawnBoids(50,"boid"):this.spawnBoids(1,"boid")),s==="ArrowDown"&&(i.getModifierState("Control")?(this.boidTrailLength-=50,this.boidTrailLength=Math.max(this.boidTrailLength,0)):i.getModifierState("Alt")&&i.getModifierState("Shift")?this.removeBoid(50,"shark"):i.getModifierState("Alt")?this.removeBoid(1,"shark"):i.getModifierState("Shift")?this.removeBoid(50):this.boidList.length>0&&this.removeBoid()),this.updateCanvas()}removeBoid(i=1,s="boid"){let t=0;for(let n=this.boidList.length-1;n>=0&&!(t>=i);n--)this.boidList[n].boidType===s&&(this.gridLists[this.boidList[n].xIndex]?.[this.boidList[n].yIndex]&&(this.gridLists[this.boidList[n].xIndex][this.boidList[n].yIndex]=this.gridLists[this.boidList[n].xIndex][this.boidList[n].yIndex].filter(l=>l!==this.boidList[n])),this.boidTrail.delete(this.boidList[n]),this.boidList.splice(n,1),t++)}computeBoids(){let i=new Map,s=new Map;this.boidList.forEach((t,n)=>{i.set(t,new Map),s.set(t,[]);let l=t.xIndex,x=t.yIndex;for(let d=-1;d<=1;d++)for(let m=-1;m<=1;m++)this.gridLists[l+d]==null||this.gridLists[l+d][x+m]==null||this.gridLists[l+d][x+m].forEach(p=>{if(p==t)return;let b=Math.sqrt((t.pos.x-p.pos.x)**2+(t.pos.y-p.pos.y)**2);i.get(t)?.set(p,b),b<t.settings.visualRange&&s.get(t)?.push(p)})}),this.boidList.forEach(t=>{if(this.gridLists[t.xIndex]&&this.gridLists[t.xIndex][t.yIndex]&&(this.gridLists[t.xIndex][t.yIndex]=this.gridLists[t.xIndex][t.yIndex].filter(n=>n!==t)),t.computePosition(s.get(t)||[],i,{left:0+this.margin,right:this.ctx.canvas.width-this.margin,top:0+this.margin,bottom:this.ctx.canvas.height-this.margin}),t.xIndex=Math.floor(t.pos.x/(2*t.settings.visualRange)),t.yIndex=Math.floor(t.pos.y/(2*t.settings.visualRange)),this.showBoidTrail)if(this.boidTrail.has(t)||this.boidTrail.set(t,[]),this.boidTrail.get(t)?.push({x:t.pos.x,y:t.pos.y}),this.boidTrailLength==0)this.boidTrail.delete(t);else for(;(this.boidTrail.get(t)?.length||0)>this.boidTrailLength;)this.boidTrail.get(t)?.shift();this.gridLists[t.xIndex]&&this.gridLists[t.xIndex][t.yIndex]&&this.gridLists[t.xIndex][t.yIndex].push(t)}),this.updateCanvas()}};c.\u0275fac=function(s){return new(s||c)},c.\u0275cmp=M({type:c,selectors:[["app-boids"]],viewQuery:function(s,t){if(s&1&&(y(A,5),y(k,5),y(P,5),y(H,5),y(D,5)),s&2){let n;u(n=S())&&(t.canvas=n.first),u(n=S())&&(t.canvasFrame=n.first),u(n=S())&&(t.image=n.first),u(n=S())&&(t.deleteButton=n.first),u(n=S())&&(t.resetButton=n.first)}},hostBindings:function(s,t){s&1&&I("resize",function(){return t.resizeCanvas()},!1,E)("keydown",function(l){return t.handleKeyboardEvent(l)},!1,F)},standalone:!0,features:[R],decls:99,vars:0,consts:[["settings",""],[1,"text-2xl","font-bold"],[1,"font-bold"],["canvas","",1,"w-full","h-full","relative"],["canvasFrame",""],["canvas",""]],template:function(s,t){s&1&&(h(0,"app-layout")(1,"div",0)(2,"h1",1),e(3,"Boids Controls"),o(),h(4,"p"),e(5,"Press "),h(6,"span",2),e(7,"Space"),o(),e(8," to toggle time "),h(9,"span",2),e(10,"x"),o(),e(11," -- to step time"),g(12,"br"),h(13,"span",2),e(14,"g"),o(),e(15," -- to toggle grid"),g(16,"br"),h(17,"span",2),e(18,"r"),o(),e(19," -- to toggle boid range"),g(20,"br"),h(21,"span",2),e(22,"t"),o(),e(23," -- to toggle boid trail"),g(24,"br"),h(25,"span",2),e(26,"Arrow Up"),o(),e(27," -- to add boids"),g(28,"br"),h(29,"span",2),e(30,"Arrow Down"),o(),e(31," -- to remove boids"),g(32,"br"),h(33,"span",2),e(34,"Alt"),o(),e(35," + "),h(36,"span",2),e(37,"Arrow Up"),o(),e(38," -- to add sharks"),g(39,"br"),h(40,"span",2),e(41,"Alt"),o(),e(42," + "),h(43,"span",2),e(44,"Arrow Down"),o(),e(45," -- to remove sharks"),g(46,"br"),h(47,"span",2),e(48,"Shift"),o(),e(49," + "),h(50,"span",2),e(51,"Arrow Up"),o(),e(52," -- to add 50 boids"),g(53,"br"),h(54,"span",2),e(55,"Shift"),o(),e(56," + "),h(57,"span",2),e(58,"Arrow Down"),o(),e(59," -- to remove 50 boids"),g(60,"br"),h(61,"span",2),e(62,"Alt"),o(),e(63," + "),h(64,"span",2),e(65,"Shift"),o(),e(66," + "),h(67,"span",2),e(68,"Arrow Up"),o(),e(69," -- to add 50 sharks"),g(70,"br"),h(71,"span",2),e(72,"Alt"),o(),e(73," + "),h(74,"span",2),e(75,"Shift"),o(),e(76," + "),h(77,"span",2),e(78,"Arrow Down"),o(),e(79," -- to remove 50 sharks"),g(80,"br"),h(81,"span",2),e(82,"Ctrl"),o(),e(83," + "),h(84,"span",2),e(85,"Arrow Up"),o(),e(86," -- to increase boid trail length"),g(87,"br"),h(88,"span",2),e(89,"Ctrl"),o(),e(90," + "),h(91,"span",2),e(92,"Arrow Down"),o(),e(93," -- to decrease boid trail length"),g(94,"br"),o()(),h(95,"div",3,4),g(97,"canvas",null,5),o()())},dependencies:[C]});let T=c;return T})();export{W as BoidsComponent};
