import{a as C}from"./chunk-6BDIY2AJ.js";import"./chunk-BWXNEIQU.js";import{Ka as a,La as h,Ma as l,Na as I,P as E,Ta as y,Ua as u,Va as b,Wa as i,Ya as R,na as M,oa as F}from"./chunk-FZ62MYCG.js";var f={boid:{boid:{separationFactor:.05,alignmentFactor:.02,cohesionFactor:5e-4,avoidFactor:0},shark:{separationFactor:.1,alignmentFactor:-.001,cohesionFactor:-.1,avoidFactor:.1}},shark:{boid:{separationFactor:0,alignmentFactor:1e-4,cohesionFactor:.001,avoidFactor:-.1},shark:{separationFactor:.05,alignmentFactor:.02,cohesionFactor:5e-4,avoidFactor:1}}};var v={boid:{type:"boid",colour:"white"},shark:{type:"shark",colour:"red"}};var L=class{constructor(x,S,e=v.boid.type,s=.01){this.pos={x:0,y:0},this.vel={x:0,y:0},this.heading=0,this.boidType=v.boid.type,this.timeLast=0,this.settings={protectedRange:10,visualRange:80,maxSpeed:300,minSpeed:150,turnFactor:4,colour:"white"},this.xIndex=0,this.yIndex=0,this.pos.x=x,this.pos.y=S,this.boidType=e,this.settings.colour=v[e].colour,this.xIndex=Math.floor(this.pos.x/(2*this.settings.visualRange)),this.yIndex=Math.floor(this.pos.y/(2*this.settings.visualRange)),this.heading=s,this.timeLast=Date.now()}setCoordinate(x){this.pos.x=x.x,this.pos.y=x.y}computePosition(x,S,e){let s={},t={},n={},d={},g={};for(let r in v){let o=v[r].type;s[o]=0,t[o]=0,n[o]=0,d[o]=0,g[o]=0}x.forEach((r,o)=>{let B=S.get(this)?.get(r)||0;B<this.settings.protectedRange&&(this.vel.x+=(this.pos.x-r.pos.x)*f[this.boidType][r.boidType].separationFactor,this.vel.y+=(this.pos.y-r.pos.y)*f[this.boidType][r.boidType].separationFactor),B<this.settings.visualRange&&B>this.settings.protectedRange&&(this.vel.x+=(this.pos.x-r.pos.x)*f[this.boidType][r.boidType].avoidFactor,this.vel.y+=(this.pos.y-r.pos.y)*f[this.boidType][r.boidType].avoidFactor,s[r.boidType]+=r.vel.x,t[r.boidType]+=r.vel.y,n[r.boidType]+=r.pos.x,d[r.boidType]+=r.pos.y,g[r.boidType]++)});for(let r in v){let o=v[r].type;g[o]>0&&(s[o]/=g[o],t[o]/=g[o],this.vel.x+=(s[o]-this.vel.x)*f[this.boidType][o].alignmentFactor,this.vel.y+=(t[o]-this.vel.y)*f[this.boidType][o].alignmentFactor,n[o]/=g[o],d[o]/=g[o],this.vel.x+=(n[o]-this.pos.x)*f[this.boidType][o].cohesionFactor,this.vel.y+=(d[o]-this.pos.y)*f[this.boidType][o].cohesionFactor)}this.pos.x<e.left&&(this.vel.x+=this.settings.turnFactor),this.pos.x>e.right&&(this.vel.x-=this.settings.turnFactor),this.pos.y<e.top&&(this.vel.y+=this.settings.turnFactor),this.pos.y>e.bottom&&(this.vel.y-=this.settings.turnFactor);let c=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);this.vel.x*this.vel.x+this.vel.y*this.vel.y<=0&&(c=0),c>this.settings.maxSpeed&&(this.vel.x=this.vel.x/c*this.settings.maxSpeed,this.vel.y=this.vel.y/c*this.settings.maxSpeed),c<this.settings.minSpeed&&(this.vel.x=this.vel.x/c*this.settings.minSpeed,this.vel.y=this.vel.y/c*this.settings.minSpeed),c==0&&(this.vel.x=this.settings.minSpeed*Math.sin(this.heading+Math.PI),this.vel.y=-this.settings.minSpeed*Math.cos(this.heading));let m=1,p=(Math.random()*2*m-m)*Math.PI/180;this.vel.x=this.vel.x*Math.cos(p)-this.vel.y*Math.sin(p),this.vel.y=this.vel.x*Math.sin(p)+this.vel.y*Math.cos(p);let w=this.getTimeStep();this.pos.x+=this.vel.x*w,this.pos.y+=this.vel.y*w,this.heading=Math.atan2(this.vel.y,this.vel.x)+Math.PI/2}getTimeStep(){let x=Date.now(),S=x-this.timeLast;return this.timeLast=x,S/1e3}};var A=["canvas"],k=["canvasFrame"],P=["image"],H=["deleteButton"],D=["resetButton"],W=(()=>{let x=class x{constructor(){this.boidCount=500,this.sharkCount=1,this.boidHeight=7,this.boidScale=.7,this.boidList=[],this.gridLists=[],this.testBoid=new L(0,0),this.paused=!1,this.showGrid=!1,this.showBoidRange=!1,this.margin=100,this.showBoidTrail=!1,this.boidTrailLength=50,this.boidTrail=new Map,this.shiftPressed=!1}ngAfterViewInit(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}this.ctx=this.canvas.nativeElement.getContext("2d"),this.resizeCanvas(),this.paused||(this.paused=!0,this.toggleTime()),this.testBoid.settings.visualRange*=this.boidScale,this.testBoid.settings.protectedRange*=this.boidScale,this.gridLists=Array.from({length:Math.ceil(this.ctx.canvas.width/(2*this.testBoid.settings.visualRange))},()=>Array.from({length:Math.ceil(this.ctx.canvas.height/(2*this.testBoid.settings.visualRange))},()=>[])),this.spawnBoids(this.boidCount,"boid"),this.spawnBoids(this.sharkCount,"shark"),this.updateCanvas()}resizeCanvas(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}let e=this.canvasFrame.nativeElement;this.ctx.canvas.width=e.clientWidth,this.ctx.canvas.height=e.clientHeight,this.updateCanvas()}toggleTime(){this.paused?(this.timeLoop=setInterval(()=>{this.computeBoids()},10),this.paused=!1):(clearInterval(this.timeLoop),this.paused=!0)}updateCanvas(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.boidList.forEach(e=>this.drawBoid(e)),this.showGrid&&this.drawGrid(),this.showBoidTrail&&this.drawTrail()}drawTrail(){this.boidTrail.forEach((e,s)=>{this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach(t=>{this.ctx.lineTo(t.x,t.y)}),this.ctx.strokeStyle=s.settings.colour,this.ctx.stroke()})}drawGrid(){this.gridLists.forEach((e,s)=>{e.forEach((t,n)=>{(s+n)%2===0?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 0, 0, 0)",this.ctx.fillRect(s*2*this.testBoid.settings.visualRange,n*2*this.testBoid.settings.visualRange,2*this.testBoid.settings.visualRange,2*this.testBoid.settings.visualRange)})})}drawBoid(e){this.ctx.save(),this.ctx.translate(e.pos.x,e.pos.y),this.ctx.rotate(e.heading),this.ctx.beginPath(),this.ctx.moveTo(0,-this.boidHeight*this.boidScale),this.ctx.lineTo(Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(-Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(0,-this.boidHeight*this.boidScale),this.ctx.fillStyle=e.settings.colour,this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this.showBoidRange&&(this.ctx.beginPath(),this.ctx.arc(e.pos.x,e.pos.y,e.settings.visualRange,0,2*Math.PI,!1),this.ctx.arc(e.pos.x,e.pos.y,e.settings.protectedRange,2*Math.PI,0,!0),this.ctx.closePath(),e.boidType==="shark"?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fill())}spawnBoids(e,s,t=-1,n={x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/2}){let d,g;t===-1?(d=this.ctx.canvas.width-80,g=this.ctx.canvas.height-80):(d=t,g=t);for(let c=0;c<e;c++){let m=n.x+Math.random()*d-d/2,p=n.y+Math.random()*g-g/2;this.boidList.push(new L(m,p,s)),s==="shark"&&(this.boidList[this.boidList.length-1].settings.turnFactor*=2),this.boidList[this.boidList.length-1].settings.visualRange*=this.boidScale,this.boidList[this.boidList.length-1].settings.protectedRange*=this.boidScale,this.boidList[this.boidList.length-1].settings.maxSpeed*=this.boidScale,this.boidList[this.boidList.length-1].settings.minSpeed*=this.boidScale,this.gridLists[this.boidList[this.boidList.length-1].xIndex][this.boidList[this.boidList.length-1].yIndex].push(this.boidList[this.boidList.length-1])}}handleKeyboardEvent(e){let s=e.key;s===" "&&this.toggleTime(),s==="x"&&this.computeBoids(),s==="g"&&(this.showGrid=!this.showGrid),s==="r"&&(this.showBoidRange=!this.showBoidRange),s==="t"&&(this.showBoidTrail=!this.showBoidTrail),s==="c"&&(this.showBoidRange=!1,this.showGrid=!1,this.showBoidTrail=!1),s==="C"&&(this.showBoidRange=!0,this.showGrid=!0,this.showBoidTrail=!0),s==="ArrowUp"&&(e.getModifierState("Control")?this.boidTrailLength+=50:e.getModifierState("Alt")&&e.getModifierState("Shift")?this.spawnBoids(50,"shark"):e.getModifierState("Alt")?this.spawnBoids(1,"shark"):e.getModifierState("Shift")?this.spawnBoids(50,"boid"):this.spawnBoids(1,"boid")),s==="ArrowDown"&&(e.getModifierState("Control")?(this.boidTrailLength-=50,this.boidTrailLength=Math.max(this.boidTrailLength,0)):e.getModifierState("Alt")&&e.getModifierState("Shift")?this.removeBoid(50,"shark"):e.getModifierState("Alt")?this.removeBoid(1,"shark"):e.getModifierState("Shift")?this.removeBoid(50):this.boidList.length>0&&this.removeBoid()),this.updateCanvas()}removeBoid(e=1,s="boid"){let t=0;for(let n=this.boidList.length-1;n>=0&&!(t>=e);n--)this.boidList[n].boidType===s&&(this.gridLists[this.boidList[n].xIndex]?.[this.boidList[n].yIndex]&&(this.gridLists[this.boidList[n].xIndex][this.boidList[n].yIndex]=this.gridLists[this.boidList[n].xIndex][this.boidList[n].yIndex].filter(d=>d!==this.boidList[n])),this.boidTrail.delete(this.boidList[n]),this.boidList.splice(n,1),t++)}computeBoids(){let e=new Map,s=new Map;this.boidList.forEach((t,n)=>{e.set(t,new Map),s.set(t,[]);let d=t.xIndex,g=t.yIndex;for(let c=-1;c<=1;c++)for(let m=-1;m<=1;m++)this.gridLists[d+c]==null||this.gridLists[d+c][g+m]==null||this.gridLists[d+c][g+m].forEach(p=>{if(p==t)return;let w=Math.sqrt((t.pos.x-p.pos.x)**2+(t.pos.y-p.pos.y)**2);e.get(t)?.set(p,w),w<t.settings.visualRange&&s.get(t)?.push(p)})}),this.boidList.forEach(t=>{if(this.gridLists[t.xIndex]&&this.gridLists[t.xIndex][t.yIndex]&&(this.gridLists[t.xIndex][t.yIndex]=this.gridLists[t.xIndex][t.yIndex].filter(n=>n!==t)),t.computePosition(s.get(t)||[],e,{left:0+this.margin,right:this.ctx.canvas.width-this.margin,top:0+this.margin,bottom:this.ctx.canvas.height-this.margin}),t.xIndex=Math.floor(t.pos.x/(2*t.settings.visualRange)),t.yIndex=Math.floor(t.pos.y/(2*t.settings.visualRange)),this.showBoidTrail)if(this.boidTrail.has(t)||this.boidTrail.set(t,[]),this.boidTrail.get(t)?.push({x:t.pos.x,y:t.pos.y}),this.boidTrailLength==0)this.boidTrail.delete(t);else for(;(this.boidTrail.get(t)?.length||0)>this.boidTrailLength;)this.boidTrail.get(t)?.shift();this.gridLists[t.xIndex]&&this.gridLists[t.xIndex][t.yIndex]&&this.gridLists[t.xIndex][t.yIndex].push(t)}),this.updateCanvas()}};x.\u0275fac=function(s){return new(s||x)},x.\u0275cmp=E({type:x,selectors:[["app-boids"]],viewQuery:function(s,t){if(s&1&&(y(A,5),y(k,5),y(P,5),y(H,5),y(D,5)),s&2){let n;u(n=b())&&(t.canvas=n.first),u(n=b())&&(t.canvasFrame=n.first),u(n=b())&&(t.image=n.first),u(n=b())&&(t.deleteButton=n.first),u(n=b())&&(t.resetButton=n.first)}},hostBindings:function(s,t){s&1&&I("resize",function(){return t.resizeCanvas()},!1,M)("keydown",function(d){return t.handleKeyboardEvent(d)},!1,F)},standalone:!0,features:[R],decls:108,vars:0,consts:[["settings",""],[1,"text-2xl","font-bold"],[1,"font-bold"],["canvas","",1,"w-full","h-full","relative"],["canvasFrame",""],["canvas",""]],template:function(s,t){s&1&&(a(0,"app-layout")(1,"div",0)(2,"h1",1),i(3,"Boids Controls"),h(),a(4,"p"),i(5,"Press "),a(6,"span",2),i(7,"Space"),h(),i(8," to toggle time "),a(9,"span",2),i(10,"x"),h(),i(11," -- to step time"),l(12,"br"),a(13,"span",2),i(14,"g"),h(),i(15," -- to toggle grid"),l(16,"br"),a(17,"span",2),i(18,"r"),h(),i(19," -- to toggle boid range"),l(20,"br"),a(21,"span",2),i(22,"t"),h(),i(23," -- to toggle boid trail"),l(24,"br"),a(25,"span",2),i(26,"Arrow Up"),h(),i(27," -- to add boids"),l(28,"br"),a(29,"span",2),i(30,"Arrow Down"),h(),i(31," -- to remove boids"),l(32,"br"),a(33,"span",2),i(34,"Alt"),h(),i(35," + "),a(36,"span",2),i(37,"Arrow Up"),h(),i(38," -- to add sharks"),l(39,"br"),a(40,"span",2),i(41,"Alt"),h(),i(42," + "),a(43,"span",2),i(44,"Arrow Down"),h(),i(45," -- to remove sharks"),l(46,"br"),a(47,"span",2),i(48,"Shift"),h(),i(49," + "),a(50,"span",2),i(51,"Arrow Up"),h(),i(52," -- to add 50 boids"),l(53,"br"),a(54,"span",2),i(55,"Shift"),h(),i(56," + "),a(57,"span",2),i(58,"Arrow Down"),h(),i(59," -- to remove 50 boids"),l(60,"br"),a(61,"span",2),i(62,"Alt"),h(),i(63," + "),a(64,"span",2),i(65,"Shift"),h(),i(66," + "),a(67,"span",2),i(68,"Arrow Up"),h(),i(69," -- to add 50 sharks"),l(70,"br"),a(71,"span",2),i(72,"Alt"),h(),i(73," + "),a(74,"span",2),i(75,"Shift"),h(),i(76," + "),a(77,"span",2),i(78,"Arrow Down"),h(),i(79," -- to remove 50 sharks"),l(80,"br"),a(81,"span",2),i(82,"Ctrl"),h(),i(83," + "),a(84,"span",2),i(85,"Arrow Up"),h(),i(86," -- to increase boid trail length"),l(87,"br"),a(88,"span",2),i(89,"Ctrl"),h(),i(90," + "),a(91,"span",2),i(92,"Arrow Down"),h(),i(93," -- to decrease boid trail length"),l(94,"br")(95,"br"),a(96,"span",2),i(97,"c"),h(),i(98," -- Clear debug overlays"),l(99,"br"),a(100,"span",2),i(101,"shift + c"),h(),i(102," -- Enable debug overlays"),l(103,"br"),h()(),a(104,"div",3,4),l(106,"canvas",null,5),h()())},dependencies:[C]});let T=x;return T})();export{W as BoidsComponent};
