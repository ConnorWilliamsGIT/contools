import{a as C}from"./chunk-3GHLPITM.js";import"./chunk-QWULPANI.js";import{Ka as T,La as F,Ma as b,Na as I,P as S,Ta as f,Ua as x,Va as v,Ya as R,na as B,oa as M}from"./chunk-FZ62MYCG.js";var g={boid:{boid:{separationFactor:.05,alignmentFactor:.02,cohesionFactor:5e-4,avoidFactor:0},shark:{separationFactor:.1,alignmentFactor:-.001,cohesionFactor:-.1,avoidFactor:.1}},shark:{boid:{separationFactor:0,alignmentFactor:1e-4,cohesionFactor:.001,avoidFactor:-.1},shark:{separationFactor:.05,alignmentFactor:.02,cohesionFactor:5e-4,avoidFactor:1}}};var p={boid:{type:"boid",colour:"white"},shark:{type:"shark",colour:"red"}};var m=class{constructor(r,y,i=p.boid.type,s=.01){this.pos={x:0,y:0},this.vel={x:0,y:0},this.heading=0,this.boidType=p.boid.type,this.timeLast=0,this.settings={protectedRange:10,visualRange:80,maxSpeed:300,minSpeed:150,turnFactor:4,colour:"white"},this.xIndex=0,this.yIndex=0,this.pos.x=r,this.pos.y=y,this.boidType=i,this.settings.colour=p[i].colour,this.xIndex=Math.floor(this.pos.x/(2*this.settings.visualRange)),this.yIndex=Math.floor(this.pos.y/(2*this.settings.visualRange)),this.heading=s,this.timeLast=Date.now()}setCoordinate(r){this.pos.x=r.x,this.pos.y=r.y}computePosition(r,y,i){let s={},t={},e={},a={},l={};for(let o in p){let h=p[o].type;s[h]=0,t[h]=0,e[h]=0,a[h]=0,l[h]=0}r.forEach((o,h)=>{let L=y.get(this)?.get(o)||0;L<this.settings.protectedRange&&(this.vel.x+=(this.pos.x-o.pos.x)*g[this.boidType][o.boidType].separationFactor,this.vel.y+=(this.pos.y-o.pos.y)*g[this.boidType][o.boidType].separationFactor),L<this.settings.visualRange&&L>this.settings.protectedRange&&(this.vel.x+=(this.pos.x-o.pos.x)*g[this.boidType][o.boidType].avoidFactor,this.vel.y+=(this.pos.y-o.pos.y)*g[this.boidType][o.boidType].avoidFactor,s[o.boidType]+=o.vel.x,t[o.boidType]+=o.vel.y,e[o.boidType]+=o.pos.x,a[o.boidType]+=o.pos.y,l[o.boidType]++)});for(let o in p){let h=p[o].type;l[h]>0&&(s[h]/=l[h],t[h]/=l[h],this.vel.x+=(s[h]-this.vel.x)*g[this.boidType][h].alignmentFactor,this.vel.y+=(t[h]-this.vel.y)*g[this.boidType][h].alignmentFactor,e[h]/=l[h],a[h]/=l[h],this.vel.x+=(e[h]-this.pos.x)*g[this.boidType][h].cohesionFactor,this.vel.y+=(a[h]-this.pos.y)*g[this.boidType][h].cohesionFactor)}this.pos.x<i.left&&(this.vel.x+=this.settings.turnFactor),this.pos.x>i.right&&(this.vel.x-=this.settings.turnFactor),this.pos.y<i.top&&(this.vel.y+=this.settings.turnFactor),this.pos.y>i.bottom&&(this.vel.y-=this.settings.turnFactor);let n=Math.sqrt(this.vel.x*this.vel.x+this.vel.y*this.vel.y);this.vel.x*this.vel.x+this.vel.y*this.vel.y<=0&&(n=0),n>this.settings.maxSpeed&&(this.vel.x=this.vel.x/n*this.settings.maxSpeed,this.vel.y=this.vel.y/n*this.settings.maxSpeed),n<this.settings.minSpeed&&(this.vel.x=this.vel.x/n*this.settings.minSpeed,this.vel.y=this.vel.y/n*this.settings.minSpeed),n==0&&(this.vel.x=this.settings.minSpeed*Math.sin(this.heading+Math.PI),this.vel.y=-this.settings.minSpeed*Math.cos(this.heading));let c=1,d=(Math.random()*2*c-c)*Math.PI/180;this.vel.x=this.vel.x*Math.cos(d)-this.vel.y*Math.sin(d),this.vel.y=this.vel.x*Math.sin(d)+this.vel.y*Math.cos(d);let u=this.getTimeStep();this.pos.x+=this.vel.x*u,this.pos.y+=this.vel.y*u,this.heading=Math.atan2(this.vel.y,this.vel.x)+Math.PI/2}getTimeStep(){let r=Date.now(),y=r-this.timeLast;return this.timeLast=r,y/1e3}};var k=["canvas"],P=["canvasFrame"],A=["image"],E=["deleteButton"],H=["resetButton"],W=(()=>{let r=class r{constructor(){this.boidCount=500,this.sharkCount=1,this.boidHeight=7,this.boidScale=.7,this.boidList=[],this.gridLists=[],this.testBoid=new m(0,0),this.paused=!1,this.showGrid=!1,this.showBoidRange=!1,this.margin=100,this.showBoidTrail=!1,this.boidTrailLength=50,this.boidTrail=new Map,this.shiftPressed=!1}ngAfterViewInit(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}this.ctx=this.canvas.nativeElement.getContext("2d"),this.resizeCanvas(),this.paused||(this.paused=!0,this.toggleTime()),this.testBoid.settings.visualRange*=this.boidScale,this.testBoid.settings.protectedRange*=this.boidScale,this.gridLists=Array.from({length:Math.ceil(this.ctx.canvas.width/(2*this.testBoid.settings.visualRange))},()=>Array.from({length:Math.ceil(this.ctx.canvas.height/(2*this.testBoid.settings.visualRange))},()=>[])),this.spawnBoids(this.boidCount,"boid"),this.spawnBoids(this.sharkCount,"shark"),this.updateCanvas()}resizeCanvas(){if(this.canvas===void 0||this.canvasFrame===void 0){console.log("Canvas not found");return}let i=this.canvasFrame.nativeElement;this.ctx.canvas.width=i.clientWidth,this.ctx.canvas.height=i.clientHeight,this.updateCanvas()}toggleTime(){this.paused?(this.timeLoop=setInterval(()=>{this.computeBoids()},10),this.paused=!1):(clearInterval(this.timeLoop),this.paused=!0)}updateCanvas(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.boidList.forEach(i=>this.drawBoid(i)),this.showGrid&&this.drawGrid(),this.showBoidTrail&&this.drawTrail()}drawTrail(){this.boidTrail.forEach((i,s)=>{this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y),i.forEach(t=>{this.ctx.lineTo(t.x,t.y)}),this.ctx.strokeStyle=s.settings.colour,this.ctx.stroke()})}drawGrid(){this.gridLists.forEach((i,s)=>{i.forEach((t,e)=>{(s+e)%2===0?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 0, 0, 0)",this.ctx.fillRect(s*2*this.testBoid.settings.visualRange,e*2*this.testBoid.settings.visualRange,2*this.testBoid.settings.visualRange,2*this.testBoid.settings.visualRange)})})}drawBoid(i){this.ctx.save(),this.ctx.translate(i.pos.x,i.pos.y),this.ctx.rotate(i.heading),this.ctx.beginPath(),this.ctx.moveTo(0,-this.boidHeight*this.boidScale),this.ctx.lineTo(Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(-Math.round(this.boidHeight*this.boidScale*.7),this.boidHeight*this.boidScale),this.ctx.lineTo(0,-this.boidHeight*this.boidScale),this.ctx.fillStyle=i.settings.colour,this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),this.showBoidRange&&(this.ctx.beginPath(),this.ctx.arc(i.pos.x,i.pos.y,i.settings.visualRange,0,2*Math.PI,!1),this.ctx.arc(i.pos.x,i.pos.y,i.settings.protectedRange,2*Math.PI,0,!0),this.ctx.closePath(),i.boidType==="shark"?this.ctx.fillStyle="rgba(255, 0, 0, 0.1)":this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fill())}spawnBoids(i,s,t=-1,e={x:this.ctx.canvas.width/2,y:this.ctx.canvas.height/2}){let a,l;t===-1?(a=this.ctx.canvas.width-80,l=this.ctx.canvas.height-80):(a=t,l=t);for(let n=0;n<i;n++){let c=e.x+Math.random()*a-a/2,d=e.y+Math.random()*l-l/2;this.boidList.push(new m(c,d,s)),s==="shark"&&(this.boidList[this.boidList.length-1].settings.turnFactor*=2),this.boidList[this.boidList.length-1].settings.visualRange*=this.boidScale,this.boidList[this.boidList.length-1].settings.protectedRange*=this.boidScale,this.boidList[this.boidList.length-1].settings.maxSpeed*=this.boidScale,this.boidList[this.boidList.length-1].settings.minSpeed*=this.boidScale,this.gridLists[this.boidList[this.boidList.length-1].xIndex][this.boidList[this.boidList.length-1].yIndex].push(this.boidList[this.boidList.length-1])}}handleKeyboardEvent(i){let s=i.key;console.log(s),s===" "&&this.toggleTime(),s==="x"&&this.computeBoids(),s==="g"&&(this.showGrid=!this.showGrid),s==="r"&&(this.showBoidRange=!this.showBoidRange),s==="t"&&(this.showBoidTrail=!this.showBoidTrail),s==="ArrowUp"&&(i.getModifierState("Control")?this.boidTrailLength+=50:i.getModifierState("Alt")&&i.getModifierState("Shift")?this.spawnBoids(50,"shark"):i.getModifierState("Alt")?this.spawnBoids(1,"shark"):i.getModifierState("Shift")?this.spawnBoids(50,"boid"):this.spawnBoids(1,"boid")),s==="ArrowDown"&&(i.getModifierState("Control")?(this.boidTrailLength-=50,this.boidTrailLength=Math.max(this.boidTrailLength,0)):i.getModifierState("Alt")&&i.getModifierState("Shift")?this.removeBoid(50,"shark"):i.getModifierState("Alt")?this.removeBoid(1,"shark"):i.getModifierState("Shift")?this.removeBoid(50):this.boidList.length>0&&this.removeBoid()),this.updateCanvas()}removeBoid(i=1,s="boid"){let t=0;for(let e=this.boidList.length-1;e>=0&&!(t>=i);e--)this.boidList[e].boidType===s&&(this.gridLists[this.boidList[e].xIndex][this.boidList[e].yIndex].filter(a=>a!==this.boidList[e]),this.boidTrail.delete(this.boidList[e]),this.boidList.splice(e,1),t++)}computeBoids(){let i=new Map,s=new Map;this.boidList.forEach((t,e)=>{i.set(t,new Map),s.set(t,[]);let a=t.xIndex,l=t.yIndex;for(let n=-1;n<=1;n++)for(let c=-1;c<=1;c++)this.gridLists[a+n]==null||this.gridLists[a+n][l+c]==null||this.gridLists[a+n][l+c].forEach(d=>{if(d==t)return;let u=Math.sqrt((t.pos.x-d.pos.x)**2+(t.pos.y-d.pos.y)**2);i.get(t)?.set(d,u),u<t.settings.visualRange&&s.get(t)?.push(d)})}),this.boidList.forEach(t=>{if(this.gridLists[t.xIndex]&&this.gridLists[t.xIndex][t.yIndex]&&(this.gridLists[t.xIndex][t.yIndex]=this.gridLists[t.xIndex][t.yIndex].filter(e=>e!==t)),t.computePosition(s.get(t)||[],i,{left:0+this.margin,right:this.ctx.canvas.width-this.margin,top:0+this.margin,bottom:this.ctx.canvas.height-this.margin}),t.xIndex=Math.floor(t.pos.x/(2*t.settings.visualRange)),t.yIndex=Math.floor(t.pos.y/(2*t.settings.visualRange)),this.showBoidTrail)if(this.boidTrail.has(t)||this.boidTrail.set(t,[]),this.boidTrail.get(t)?.push({x:t.pos.x,y:t.pos.y}),this.boidTrailLength==0)this.boidTrail.delete(t);else for(;(this.boidTrail.get(t)?.length||0)>this.boidTrailLength;)this.boidTrail.get(t)?.shift();this.gridLists[t.xIndex]&&this.gridLists[t.xIndex][t.yIndex]&&this.gridLists[t.xIndex][t.yIndex].push(t)}),this.updateCanvas()}};r.\u0275fac=function(s){return new(s||r)},r.\u0275cmp=S({type:r,selectors:[["app-boids"]],viewQuery:function(s,t){if(s&1&&(f(k,5),f(P,5),f(A,5),f(E,5),f(H,5)),s&2){let e;x(e=v())&&(t.canvas=e.first),x(e=v())&&(t.canvasFrame=e.first),x(e=v())&&(t.image=e.first),x(e=v())&&(t.deleteButton=e.first),x(e=v())&&(t.resetButton=e.first)}},hostBindings:function(s,t){s&1&&I("resize",function(){return t.resizeCanvas()},!1,B)("keydown",function(a){return t.handleKeyboardEvent(a)},!1,M)},standalone:!0,features:[R],decls:6,vars:0,consts:[["settings",""],["canvas","",1,"w-full","h-full","relative"],["canvasFrame",""],["canvas",""]],template:function(s,t){s&1&&(T(0,"app-layout"),b(1,"div",0),T(2,"div",1,2),b(4,"canvas",null,3),F()())},dependencies:[C]});let w=r;return w})();export{W as BoidsComponent};
