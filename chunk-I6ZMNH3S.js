import{Da as $,Fa as T,Ga as H,Ha as J,Ia as Q,Ja as V,Ka as b,La as u,Ma as D,Na as X,Oa as z,P as K,Ra as Y,Wa as x,Xa as Z,Ya as ee,c as q,la as F,lb as te,qa as C,va as W}from"./chunk-FZ62MYCG.js";function fe(m,p){if(m&1&&(b(0,"div")(1,"p",12),x(2," Note: Anvil image should look something like this."),D(3,"br"),x(4," Don't include the UI border or anything else in the screenshot. "),u(),D(5,"img",13),u()),m&2){let E=z();C(5),T("src",E.exampleImg,F)}}function me(m,p){m&1&&x(0," \u2192 ")}function de(m,p){if(m&1&&(D(0,"img",21),$(1,me,1,0)),m&2){let E=p.$implicit,n=p.$index,r=p.$count;Y("src","assets/img/",E,".png",F),C(),H(1,n!==r-1?1:-1)}}function ge(m,p){if(m&1&&(b(0,"div",14)(1,"div",15),D(2,"img",16),u(),D(3,"div",17),b(4,"div",18)(5,"p",19),x(6),D(7,"br"),x(8," Moves: "),u(),b(9,"div",20),Q(10,de,2,2,null,null,J),u()()()),m&2){let E=z();C(2),T("src",E.imageUrl,F),C(4),Z(" Steps: ",E.forgeText().length,""),C(4),V(E.forgeText())}}var Ie=(()=>{let p=class p{constructor(){this.modalButton=document.getElementById("modal_button"),this.imageUrl="",this.exampleImg="../../../assets/img/exampleForge.png",this.forgeText=W([])}ngOnInit(){this.modalButton=document.getElementById("modal_button")}pasteImage(){return q(this,null,function*(){let n=yield navigator.clipboard.read();for(let r of n){if(!r.types.includes("image/png")){console.log("Clipboard item is not an image");continue}let o=yield r.getType("image/png");this.imageUrl=URL.createObjectURL(o),this.processImage()}})}processImage(){try{let n=document.createElement("canvas"),r=n.getContext("2d"),o=new Image;o.onload=()=>{if(r===null){console.log("Context is null");return}n.width=o.width,n.height=o.height,r.drawImage(o,0,0,n.width,n.height);let a=r.getImageData(0,0,o.width,o.height),v=0,d=!1,c=0,f=0;for(let e=0;e<o.height;e++){for(let i=0;i<o.width;i++){let l=this.getPixel(a,e*o.width+i);if(l[0]==63&&l[1]==63&&l[2]==63)v+=1,d||(d=!0,c=e,f=i);else if(d)break}if(d)break}if(!d)throw console.log("A not found"),new Error("A not found");let t=v/3;f-=t;let P=!1,B=0,ie=!1,A=0,M=96;for(let e=0;e<o.width;e++){let i=this.getPixel(a,(M*t+c)*o.width+e);if(i[0]==0&&i[1]==255&&i[2]==6){B=e;break}}M=90;for(let e=0;e<o.width;e++){let i=this.getPixel(a,(M*t+c)*o.width+e);if(i[0]==255&&i[1]==0&&i[2]==0){A=e;break}}let h=(A-B)/t;if(console.log("distance: "+h),isNaN(h))throw console.log("Distance is NaN"),new Error("Distance is NaN");let w=[[56,66],[75,85],[94,104]],k=[0,0,0],U=[0,0,0];for(let e=0;e<w.length;e++)for(let i=c+4*t;i<c+14*t;i++){for(let l=f+w[e][0]*t;l<f+w[e][1]*t;l++){let s=this.getPixel(a,i*o.width+l);if(s[0]>100&&s[1]>100&&s[2]>100){k[e]=i,U[e]=l;break}}if(k[e]!==0)break}for(let e=0;e<k.length;e++)k[e]=(k[e]-4*t)/t,U[e]=(U[e]-w[e][0]*t)/t;let y=[0,0,0],R=[0,0,0];for(let e=0;e<w.length;e++)for(let i=f+w[e][1]*t-1;i>=f+w[e][0]*t;i--){for(let l=c+4*t;l<c+14*t;l++){let s=this.getPixel(a,l*o.width+i);if(s[0]>100&&s[1]>100&&s[2]>100){y[e]=l,R[e]=i;break}}if(y[e]!==0)break}for(let e=0;e<y.length;e++)y[e]=(y[e]-4*t)/t,R[e]=(R[e]-w[e][0]*t)/t;let S=[0,0,0],O=[0,0,0];for(let e=0;e<w.length;e++)for(let i=f+w[e][0]*t;i<f+w[e][1]*t;i++){for(let l=c+14*t-1;l>=c+4*t;l--){let s=this.getPixel(a,l*o.width+i);if(s[0]>100&&s[1]>100&&s[2]>100){S[e]=l,O[e]=i;break}}if(S[e]!==0)break}for(let e=0;e<S.length;e++)S[e]=(S[e]-4*t)/t,O[e]=(O[e]-w[e][0]*t)/t;let L=k.map((e,i)=>{let l=y[i]-k[i],s=R[i]-U[i];return{rowDiff:l,colDiff:s}}).map(e=>e.rowDiff/e.colDiff),oe=y.map((e,i)=>{let l=S[i]-y[i],s=O[i]-R[i];return{rowDiff:l,colDiff:s}}).map(e=>e.rowDiff/e.colDiff),ne={"0.23":-1,"0.21":13,"0.176":16},le={"0.26":-1,"0.15":13,"0.12":16},re={"-0.23":-15,"-0.29":2,"-0.69":7},ae={"-0.16":-15,"-0.36":2,"-0.79":7},g=[0,0,0],j;for(let e=0;e<3;e++){let i=L[e]===0,l=i?oe[e]:L[e];t===2?j=i?re:ne:j=i?ae:le,g[e]=this.findClosestIcon(j,l)}for(let e=0;e<k.length;e++)k[e]<=0&&(g[e]=0);let I=[[0,0,0],[0,0,0],[0,0,0]];for(let e=0;e<3;e++){let i=this.getPixel(a,(c+17*t)*o.width+f+52*t+e*19*t),l=this.getPixel(a,(c+19*t)*o.width+f+52*t+e*19*t),s=this.getPixel(a,(c+21*t)*o.width+f+52*t+e*19*t);I[e][0]=i[0]==216&&i[1]==86&&i[2]==0?1:0,I[e][1]=l[0]==216&&l[1]==86&&l[2]==0?1:0,I[e][2]=s[0]==216&&s[1]==86&&s[2]==0?1:0}let se=h,_=[0,0,0];if(I[0][2]==1){if(g[0]==-1){let e=this.findBestOption(h,0,0,I,g);h-=e,_[0]=e}else h-=g[0],_[0]=g[0];if(I[1][1]==1&&g[1]==-1){let e=this.findBestOption(h,1,1,I,g);h-=e,_[1]=e}else h-=g[1],_[1]=g[1];if(I[2][0]==1&&g[2]==-1){let e=this.findBestOption(h,2,2,I,g);h-=e,_[2]=e}else h-=g[2],_[2]=g[2]}let[ue,N]=this.minStepsToN(h);_=_.filter(e=>e!==0),N.push(..._.reverse()),console.log("Moves: "+N);let G=0;for(let e=0;e<N.length;e++)G+=N[e];let ce=G==se;console.log("validation check: "+ce),this.forgeText.set(N.map(e=>e.toString())),r.putImageData(a,0,0),this.imageUrl=n.toDataURL()},o.src=this.imageUrl;return}catch(n){console.log(n),console.log("Error processing image"),this.toggleModal(),this.imageUrl=""}}findClosestIcon(n,r){let o=Object.keys(n)[0],a=Math.abs(r-Number(o));for(let v of Object.keys(n)){let d=Math.abs(r-Number(v));d<a&&(o=v,a=d)}return n[Number(o)]}getPixel(n,r){return n.data.subarray(r*4,r*4+4)}setPixel(n,r,o){n.data.set(o,r*4)}toggleModal(){this.modalButton?(this.modalButton.click(),console.log("modalButton toggled")):console.log("modalButton not found")}findBestOption(n,r,o,a,v){let d=0,c=1e3,f=[-3,-6,-9];for(let t=0;t<3;t++){let P=n+f[t],[B,ie]=this.minStepsToN(P);B<c&&(d=f[t],c=B)}return d}minStepsToN(n){let r=[-15,-9,-6,-3,2,7,13,16],o=150;n=Math.abs(Math.round(n));let a=[{sum:0,steps:0,path:[]}],v=new Set([0]);for(;a.length>0;){let{sum:d,steps:c,path:f}=a.shift();if(d===n)return[c,f];for(let t of r){let P=d+t;P>o||v.has(P)||(a.push({sum:P,steps:c+1,path:[...f,t]}),v.add(P))}}return console.log("No solution found."),[-1,[]]}};p.\u0275fac=function(r){return new(r||p)},p.\u0275cmp=K({type:p,selectors:[["app-forge"]],standalone:!0,features:[ee],decls:21,vars:2,consts:[[1,"text-center","content-center","justify-center","h-svh","max-h-svh","items-center","flex","flex-col"],[1,"text-3xl","flex-none","font-bold","p-3","text-center","w-100","text-secondary"],[1,"text-center","content-center","justify-center","items-center","flex-1","flex","flex-col","w-[100%]"],[1,"btn","btn-primary","grow-0",3,"click"],[4,"ngIf"],["class","flex w-[90%] items-start mt-10 gap-3 max-h-[700px]",4,"ngIf"],["id","modal_button","onclick","error_modal.showModal()",1,"btn","hidden"],["id","error_modal",1,"modal"],[1,"modal-box"],[1,"text-lg","font-bold"],[1,"py-4"],["method","dialog",1,"modal-backdrop"],[1,"text-neutral-content"],["alt","Example Image",3,"src"],[1,"flex","w-[90%]","items-start","mt-10","gap-3","max-h-[700px]"],[1,"outline","outline-base-content/50","rounded","rounded-4","grid","flex-none"],["alt","Pasted Image",3,"src"],[1,"inline-block","h-auto","min-h-[1em]","w-0.5","self-stretch","bg-base","dark:bg-white/10"],[1,"flex-1","max-h-[700px]","overflow-y-auto"],[1,"text-neutral-content","whitespace-normal"],[1,"flex","gap-1","items-center","justify-center","mt-5","flex-wrap"],["alt","Pasted Image",1,"w-10",3,"src"]],template:function(r,o){r&1&&(b(0,"div",0)(1,"h1",1),x(2,"Contools"),u(),b(3,"div",2)(4,"button",3),X("click",function(){return o.pasteImage()}),x(5,"Paste Image from clipboard"),u(),$(6,fe,6,1,"div",4)(7,ge,12,2,"div",5),u()(),b(8,"button",6),x(9,"open modal"),u(),b(10,"dialog",7)(11,"div",8)(12,"h3",9),x(13,"An error has occurred."),u(),b(14,"p",10),x(15,"Click anywhere to continue. "),D(16,"br"),x(17," If the error persists, close and reopen the page."),u()(),b(18,"form",11)(19,"button"),x(20,"close"),u()()()),r&2&&(C(6),T("ngIf",o.imageUrl==""),C(),T("ngIf",o.imageUrl!=""))},dependencies:[te]});let m=p;return m})();export{Ie as ForgeComponent};
