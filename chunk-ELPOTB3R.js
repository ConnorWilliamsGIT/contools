import{Da as $,Fa as T,Ga as W,Ha as H,Ia as J,Ja as X,Ka as k,La as b,Ma as E,Na as Y,Oa as z,P as G,Ra as Z,Ta as ee,Ua as te,Va as ie,Wa as v,Xa as oe,Ya as ne,c as q,la as M,lb as le,qa as D,va as K}from"./chunk-FZ62MYCG.js";var ge=["errorModal"];function de(g,d){if(g&1&&(k(0,"div")(1,"p",12),v(2," Note: Anvil image should look something like this."),E(3,"br"),v(4," Don't include the UI border or anything else in the screenshot. "),b(),E(5,"img",13),b()),g&2){let P=z();D(5),T("src",P.exampleImg,M)}}function he(g,d){g&1&&v(0," \u2192 ")}function pe(g,d){if(g&1&&(E(0,"img",21),$(1,he,1,0)),g&2){let P=d.$implicit,r=d.$index,l=d.$count;Z("src","assets/img/",P,".png",M),D(),W(1,r!==l-1?1:-1)}}function ue(g,d){if(g&1&&(k(0,"div",14)(1,"div",15),E(2,"img",16),b(),E(3,"div",17),k(4,"div",18)(5,"p",19),v(6),E(7,"br"),v(8," Moves: "),b(),k(9,"div",20),J(10,pe,2,2,null,null,H),b()()()),g&2){let P=z();D(2),T("src",P.imageUrl,M),D(4),oe(" Steps: ",P.forgeText().length,""),D(4),X(P.forgeText())}}var De=(()=>{let d=class d{constructor(){this.modalButton=document.getElementById("modal_button"),this.imageUrl="",this.exampleImg="/assets/img/exampleForge.png",this.forgeText=K([])}ngOnInit(){this.modalButton=document.getElementById("modal_button")}pasteImage(){return q(this,null,function*(){let r=yield navigator.clipboard.read();for(let l of r){if(!l.types.includes("image/png")){console.log("Clipboard item is not an image");continue}let i=yield l.getType("image/png");this.imageUrl=URL.createObjectURL(i),this.processImage()}})}processImage(){try{let r=document.createElement("canvas"),l=r.getContext("2d"),i=new Image;i.onload=()=>{if(l===null){console.log("Context is null");return}r.width=i.width,r.height=i.height,console.log("Image width: "+i.width),console.log("Image height: "+i.height),l.drawImage(i,0,0,r.width,r.height);let a=l.getImageData(0,0,i.width,i.height),h=0,p=!1,c=0,m=0;for(let e=0;e<i.height;e++){for(let t=0;t<i.width;t++){let n=this.getPixel(a,e*i.width+t);if(n[0]==63&&n[1]==63&&n[2]==63)h+=1,p||(p=!0,c=e,m=t);else if(p)break}if(p)break}if(!p)throw console.log("A not found"),new Error("A not found");let o=h/3;m-=o;let R=0,A=0,F=96;for(let e=0;e<i.width;e++){let t=this.getPixel(a,(F*o+c)*i.width+e);if(t[0]==0&&t[1]==255&&t[2]==6){R=e;break}}F=90;for(let e=0;e<i.width;e++){let t=this.getPixel(a,(F*o+c)*i.width+e);if(t[0]==255&&t[1]==0&&t[2]==0){A=e;break}}let u=(A-R)/o;if(console.log("distance: "+u),isNaN(u))throw console.log("Distance is NaN"),new Error("Distance is NaN");let x=[[56,66],[75,85],[94,104]],y=[0,0,0],U=[0,0,0];for(let e=0;e<x.length;e++)for(let t=c+4*o;t<c+14*o;t++){for(let n=m+x[e][0]*o;n<m+x[e][1]*o;n++){let s=this.getPixel(a,t*i.width+n);if(s[0]>100&&s[1]>100&&s[2]>100){y[e]=t,U[e]=n;break}}if(y[e]!==0)break}for(let e=0;e<y.length;e++)y[e]=(y[e]-4*o)/o,U[e]=(U[e]-x[e][0]*o)/o;let C=[0,0,0],N=[0,0,0];for(let e=0;e<x.length;e++)for(let t=m+x[e][1]*o-1;t>=m+x[e][0]*o;t--){for(let n=c+4*o;n<c+14*o;n++){let s=this.getPixel(a,n*i.width+t);if(s[0]>100&&s[1]>100&&s[2]>100){C[e]=n,N[e]=t;break}}if(C[e]!==0)break}for(let e=0;e<C.length;e++)C[e]=(C[e]-4*o)/o,N[e]=(N[e]-x[e][0]*o)/o;let S=[0,0,0],B=[0,0,0];for(let e=0;e<x.length;e++)for(let t=m+x[e][0]*o;t<m+x[e][1]*o;t++){for(let n=c+14*o-1;n>=c+4*o;n--){let s=this.getPixel(a,n*i.width+t);if(s[0]>100&&s[1]>100&&s[2]>100){S[e]=n,B[e]=t;break}}if(S[e]!==0)break}for(let e=0;e<S.length;e++)S[e]=(S[e]-4*o)/o,B[e]=(B[e]-x[e][0]*o)/o;let L=y.map((e,t)=>{let n=C[t]-y[t],s=N[t]-U[t];return{rowDiff:n,colDiff:s}}).map(e=>e.rowDiff/e.colDiff),re=C.map((e,t)=>{let n=S[t]-C[t],s=B[t]-N[t];return{rowDiff:n,colDiff:s}}).map(e=>e.rowDiff/e.colDiff),ae={"0.23":-1,"0.21":13,"0.176":16},se={"0.26":-1,"0.15":13,"0.12":16},ce={"-0.23":-15,"-0.29":2,"-0.69":7},fe={"-0.16":-15,"-0.36":2,"-0.79":7},_=[0,0,0],j;for(let e=0;e<3;e++){let t=L[e]===0,n=t?re[e]:L[e];o===2?j=t?ce:ae:j=t?fe:se,_[e]=this.findClosestIcon(j,n)}for(let e=0;e<y.length;e++)y[e]<=0&&(_[e]=0);let w=[[0,0,0],[0,0,0],[0,0,0]];for(let e=0;e<3;e++){let t=this.getPixel(a,(c+17*o)*i.width+m+52*o+e*19*o),n=this.getPixel(a,(c+19*o)*i.width+m+52*o+e*19*o),s=this.getPixel(a,(c+21*o)*i.width+m+52*o+e*19*o);w[e][0]=t[0]==216&&t[1]==86&&t[2]==0?1:0,w[e][1]=n[0]==216&&n[1]==86&&n[2]==0?1:0,w[e][2]=s[0]==216&&s[1]==86&&s[2]==0?1:0}let me=u,I=[0,0,0],f=[0,1,2];for(let e=0;e<3;e++){if(w[e][2]==1&&w[e][1]==0&&w[e][0]==0){f=[e,...f.filter((t,n)=>n!==e)];break}if(w[e][2]==0&&w[e][1]==1&&w[e][0]==1){f=[...f.filter((t,n)=>n!==e),e];break}}if(w[f[0]][2]==1){if(_[f[0]]==-1){let e=this.findBestOption(u);u-=e,I[0]=e}else u-=_[f[0]],I[0]=_[f[0]];if(w[f[1]][1]==1&&_[f[1]]==-1){let e=this.findBestOption(u);u-=e,I[1]=e}else u-=_[f[1]],I[1]=_[f[1]];if(w[f[2]][0]==1&&_[f[2]]==-1){let e=this.findBestOption(u);u-=e,I[2]=e}else u-=_[f[2]],I[2]=_[f[2]]}let[be,O]=this.minStepsToN(u);I=I.filter(e=>e!==0),O.push(...I.reverse()),console.log("Moves: "+O);let Q=0;for(let e=0;e<O.length;e++)Q+=O[e];let V=Q==me;if(console.log("validation check: "+V),!V)throw console.log("Validation check failed"),new Error("Validation check failed");this.forgeText.set(O.map(e=>e.toString())),l.putImageData(a,0,0),this.imageUrl=r.toDataURL()},i.src=this.imageUrl;return}catch(r){console.log(r),console.log("Error processing image"),this.errorModal.nativeElement.showModal(),this.imageUrl=""}}findClosestIcon(r,l){let i=Object.keys(r)[0],a=Math.abs(l-Number(i));for(let h of Object.keys(r)){let p=Math.abs(l-Number(h));p<a&&(i=h,a=p)}return r[Number(i)]}getPixel(r,l){return r.data.subarray(l*4,l*4+4)}setPixel(r,l,i){r.data.set(i,l*4)}findBestOption(r){let l=0,i=1e3,a=[-3,-6,-9];for(let h=0;h<3;h++){let p=r-a[h],[c,m]=this.minStepsToN(p);c<i&&(l=a[h],i=c)}return l}minStepsToN(r){let l=[-15,-9,-6,-3,2,7,13,16],i=150;r=Math.round(r);let a=[{sum:0,steps:0,path:[]}],h=new Set([0]);for(;a.length>0;){let{sum:p,steps:c,path:m}=a.shift();if(p===r)return[c,m];for(let o of l){let R=p+o;R>i||h.has(R)||(a.push({sum:R,steps:c+1,path:[...m,o]}),h.add(R))}}return console.log("No solution found."),[-1,[]]}};d.\u0275fac=function(l){return new(l||d)},d.\u0275cmp=G({type:d,selectors:[["app-forge"]],viewQuery:function(l,i){if(l&1&&ee(ge,5),l&2){let a;te(a=ie())&&(i.errorModal=a.first)}},standalone:!0,features:[ne],decls:20,vars:2,consts:[[1,"text-center","content-center","justify-center","h-svh","max-h-svh","items-center","flex","flex-col"],[1,"text-3xl","flex-none","font-bold","p-3","text-center","w-100","text-secondary"],[1,"text-center","content-center","justify-center","items-center","flex-1","flex","flex-col","w-[100%]"],[1,"btn","btn-primary","grow-0",3,"click"],[4,"ngIf"],["class","flex w-[90%] items-start mt-10 gap-3 max-h-[700px]",4,"ngIf"],[1,"modal"],["errorModal",""],[1,"modal-box"],[1,"text-lg","font-bold"],[1,"py-4"],["method","dialog",1,"modal-backdrop"],[1,"text-neutral-content"],["alt","Example Image",3,"src"],[1,"flex","w-[90%]","items-start","mt-10","gap-3","max-h-[700px]"],[1,"outline","outline-base-content/50","rounded","rounded-4","grid","flex-none"],["alt","Pasted Image",3,"src"],[1,"inline-block","h-auto","min-h-[1em]","w-0.5","self-stretch","bg-base","dark:bg-white/10"],[1,"flex-1","max-h-[700px]","overflow-y-auto"],[1,"text-neutral-content","whitespace-normal"],[1,"flex","gap-1","items-center","justify-center","mt-5","flex-wrap"],["alt","Pasted Image",1,"w-10",3,"src"]],template:function(l,i){l&1&&(k(0,"div",0)(1,"h1",1),v(2,"Contools"),b(),k(3,"div",2)(4,"button",3),Y("click",function(){return i.pasteImage()}),v(5,"Paste Image from clipboard"),b(),$(6,de,6,1,"div",4)(7,ue,12,2,"div",5),b()(),k(8,"dialog",6,7)(10,"div",8)(11,"h3",9),v(12,"An error has occurred."),b(),k(13,"p",10),v(14,"Click anywhere to continue. "),E(15,"br"),v(16," If the error persists, close and reopen the page."),b()(),k(17,"form",11)(18,"button"),v(19,"close"),b()()()),l&2&&(D(6),T("ngIf",i.imageUrl==""),D(),T("ngIf",i.imageUrl!=""))},dependencies:[le]});let g=d;return g})();export{De as ForgeComponent};
